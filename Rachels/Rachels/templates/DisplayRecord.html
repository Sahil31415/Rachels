{% extends "base.html" %}

{% block title %}All Records{% endblock %}

{% block head %}
<style>
  /* --- All Records Premium Styles --- */

  /* Header Section */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 32px;
  }

  .header-brand {
    display: flex;
    gap: 16px;
    align-items: center;
  }
  
  .header-brand .icon {
    width: 52px; height: 52px;
    border-radius: 14px;
    display: grid; place-items: center;
    background: linear-gradient(135deg, var(--accent-600), var(--accent));
    color: #fff;
    font-weight: 800;
    font-size: 20px;
    box-shadow: 0 4px 12px rgba(90, 64, 50, 0.2);
  }

  /* Filter Bar */
  .filter-container {
    background: #fff; 
    padding: 24px;
    border-radius: 16px;
    border: 1px solid rgba(90, 64, 50, 0.08);
    margin-bottom: 24px;
    box-shadow: var(--shadow-sm);
  }

  .filter-row {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    align-items: center;
  }

  /* Inputs (Matched to Add Record Style) */
  .form-control {
    padding: 12px 16px;
    border-radius: 10px;
    border: 1px solid rgba(90, 64, 50, 0.15);
    background: #fff;
    font-size: 14px;
    color: var(--text);
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(90, 64, 50, 0.02);
  }
  .form-control:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(90, 64, 50, 0.1);
    transform: translateY(-1px);
  }
  
  /* Custom Select Arrow */
  select.form-control {
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%235A4032' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 14px;
    appearance: none;
    padding-right: 36px;
  }

  /* Table Styling */
  .table-wrapper {
    overflow-x: auto;
    border-radius: 16px;
    border: 1px solid rgba(90, 64, 50, 0.08);
    background: var(--page);
    box-shadow: var(--shadow-sm);
  }

  .styled-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  .styled-table thead th {
    background: rgba(90, 64, 50, 0.04);
    color: var(--accent);
    font-weight: 700;
    text-transform: uppercase;
    font-size: 12px;
    letter-spacing: 0.08em;
    padding: 18px 24px;
    text-align: left;
    border-bottom: 1px solid rgba(90, 64, 50, 0.1);
  }

  .styled-table tbody tr {
    border-bottom: 1px solid rgba(90, 64, 50, 0.06);
    transition: background 0.15s;
  }
  
  .styled-table tbody tr:hover {
    background: rgba(255, 255, 255, 0.8);
  }

  .styled-table td {
    padding: 18px 24px;
    vertical-align: middle;
    color: var(--text);
  }

  /* Action Buttons (Icons) */
  .action-group {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  
  .btn-icon {
    width: 32px; height: 32px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 8px;
    border: 1px solid transparent;
    transition: all 0.2s;
    background: transparent;
    cursor: pointer;
    color: var(--muted);
  }
  
  .btn-icon.view:hover { background: rgba(90, 64, 50, 0.1); color: var(--accent); }
  .btn-icon.done:hover { background: rgba(60, 90, 60, 0.1); color: #3C5A3C; border-color: rgba(60, 90, 60, 0.2); }
  .btn-icon.delete:hover { background: rgba(166, 58, 46, 0.1); color: #a63a2e; border-color: rgba(166, 58, 46, 0.2); }
  
  .btn-icon svg { width: 16px; height: 16px; stroke-width: 2px; }

  /* Status Badges */
  .badge { display: inline-flex; align-items: center; padding: 6px 12px; border-radius: 99px; font-size: 11px; font-weight: 700; letter-spacing: 0.03em; text-transform: uppercase; }
  .badge.pending { background: rgba(160, 82, 45, 0.1); color: #A0522D; }
  .badge.completed { background: rgba(60, 90, 60, 0.1); color: #3C5A3C; }
  .badge.other { background: rgba(0,0,0,0.05); color: var(--muted); }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 30px;
    flex-wrap: wrap;
  }
  
  .page-item {
    width: 36px; height: 36px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 8px;
    border: 1px solid rgba(90, 64, 50, 0.1);
    color: var(--muted);
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
    background: #fff;
  }
  
  .page-item:hover {
    border-color: var(--accent);
    color: var(--accent);
    transform: translateY(-2px);
  }
  
  .page-item.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
  }

</style>
{% endblock %}

{% block content %}
<div class="container">
  
  <div class="page-header">
    <div class="header-brand">
      <div class="icon">R</div>
      <div>
        <div style="font-weight:800; font-size:18px;">Record Manager</div>
        <div class="muted" style="font-size:13px">All Records</div>
      </div>
    </div>

    <div style="display:flex; gap:12px;">
      <a href="{% url 'export_form' %}" class="btn ghost">Export Data</a>
      <a href="{% url 'Home' %}" class="btn ghost">Dashboard</a>
      <a href="{% url 'add_record' %}" class="btn primary" style="box-shadow: var(--shadow-sm);">+ Add Record</a>
    </div>
  </div>

  <div class="filter-container">
    <div style="margin-bottom: 20px; display:flex; gap:20px; border-bottom:1px solid rgba(90,64,50,0.08); padding-bottom:10px;">
      <a href="?{% if request.GET.location %}location={{ request.GET.location }}&{% endif %}{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}{% if request.GET.q %}q={{ request.GET.q }}{% endif %}" 
         style="font-weight:700; font-size:14px; color:var(--text); text-decoration:none; {% if not request.GET.month %}border-bottom:2px solid var(--accent); margin-bottom:-11px;{% else %}opacity:0.5;{% endif %} padding-bottom:8px; transition:0.2s;">
         All Time
      </a>
      <a href="?month=this{% if request.GET.location %}&location={{ request.GET.location }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
         style="font-weight:700; font-size:14px; color:var(--text); text-decoration:none; {% if request.GET.month == 'this' %}border-bottom:2px solid var(--accent); margin-bottom:-11px;{% else %}opacity:0.5;{% endif %} padding-bottom:8px; transition:0.2s;">
         This Month
      </a>
    </div>

    <form method="get" class="filter-row">
      <div style="flex: 2; position:relative; min-width: 240px;">
        <input type="search" name="q" placeholder="Search item, vendor or details..." value="{{ request.GET.q|default:'' }}" class="form-control" style="padding-left: 38px;">
        <svg style="position:absolute; left:12px; top:50%; transform:translateY(-50%); color:var(--muted); pointer-events:none;" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      </div>

      {% if user.is_superuser %}
      <select name="location" class="form-control" style="flex: 1; min-width: 160px;">
        <option value="">All Locations</option>
        <option value="Dulari" {% if request.GET.location == "Dulari" %}selected{% endif %}>Dulari</option>
        <option value="Pours and Plates" {% if request.GET.location == "Pours and Plates" %}selected{% endif %}>Pours & Plates</option>
        <option value="Rachels" {% if request.GET.location == "Rachels" %}selected{% endif %}>Rachels</option>
      </select>
      {% endif %}

      <select name="status" class="form-control" style="flex: 1; min-width: 160px;">
        <option value="">Any Status</option>
        <option value="Pending" {% if request.GET.status == "Pending" %}selected{% endif %}>Pending</option>
        <option value="Completed" {% if request.GET.status == "Completed" %}selected{% endif %}>Completed</option>
      </select>

      <button type="submit" class="btn primary" style="padding:12px 24px;">Filter</button>
      <a href="{% url 'show_all_records' %}" style="color:var(--muted); font-size:13px; text-decoration:underline; white-space:nowrap;">Reset filters</a>
    </form>
  </div>

  <div class="table-wrapper">
    <table class="styled-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Location</th>
          <th>Status</th>
          <th>Details</th>
          <th style="width: 140px; text-align:right;">Actions</th>
        </tr>
      </thead>
      <tbody>
      {% if records %}
        {% for r in records %}
          <tr>
            <td style="white-space:nowrap; color:var(--muted);">{{ r.date }}</td>
            <td><strong>{{ r.location }}</strong></td>
            <td>
              {% if r.status|lower == "pending" %}
                <span class="badge pending">Pending</span>
              {% elif r.status|lower == "completed" %}
                <span class="badge completed">Completed</span>
              {% else %}
                <span class="badge other">{{ r.status }}</span>
              {% endif %}
            </td>
            <td style="font-size:13px; line-height:1.5;">
              <div style="font-weight:600; color:var(--text);">{{ r.vendor.name }}</div>
              <div style="color:var(--muted);">{{ r.item.item_name|truncatechars:45 }}</div>
            </td>
            <td>
              <div class="action-group" style="justify-content: flex-end;">
                <a href="{% url 'record_detail' r.pk %}" class="btn-icon view" title="View Details">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                </a>

                {% if r.status|lower != "completed" %}
                <form method="post" action="{% url 'mark_completed' r.pk %}" style="display:inline">{% csrf_token %}
                  <button class="btn-icon done" type="submit" title="Mark as Completed">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                  </button>
                </form>
                {% endif %}

                {% if user.is_superuser %}
                <form method="post" action="{% url 'delete_record' r.pk %}" onsubmit="return confirm('Delete this record?');" style="display:inline">{% csrf_token %}
                  <button class="btn-icon delete" type="submit" title="Delete">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                  </button>
                </form>
                {% endif %}
                
              </div>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="5">
            <div class="empty-state">
              <svg style="color:rgba(90,64,50,0.2); margin-bottom:12px;" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
              <div style="font-weight:600; font-size:16px;">No records found</div>
              <div style="font-size:13px; margin-top:4px;">Try adjusting your filters or search query.</div>
            </div>
          </td>
        </tr>
      {% endif %}
      </tbody>
    </table>
  </div>

  {% if page_obj %}
    <div class="pagination">
      {% if page_obj.has_previous %}
        <a class="page-item" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.location %}location={{ request.GET.location }}&{% endif %}{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}page={{ page_obj.previous_page_number }}">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
        </a>
      {% endif %}

      {% for item in pagination_items %}
        {% if item == '...' %}
          <span class="page-item" style="border:none; background:transparent;">...</span>
        {% else %}
          {% if item == page_obj.number %}
            <span class="page-item active">{{ item }}</span>
          {% else %}
            <a class="page-item" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.location %}location={{ request.GET.location }}&{% endif %}{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}page={{ item }}">{{ item }}</a>
          {% endif %}
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <a class="page-item" href="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.location %}location={{ request.GET.location }}&{% endif %}{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}page={{ page_obj.next_page_number }}">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </a>
      {% endif %}
    </div>
  {% endif %}

</div>
{% endblock %}