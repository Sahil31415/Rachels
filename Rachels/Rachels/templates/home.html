{% extends "base.html" %}

{% block title %}Home — Records{% endblock %}

{% block head %}
<style>
  /* --- Dashboard Specific Layouts --- */
  
  /* Responsive Grid for Top Row and Location Cards */
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    width: 100%;
  }

  /* Typography Enhancements */
  .stat-label { font-size: 13px; color: var(--muted); font-weight: 500; text-transform: uppercase; letter-spacing: 0.05em; }
  .stat-number { font-size: 48px; font-weight: 800; color: var(--accent-600); line-height: 1; margin: 12px 0; letter-spacing: -0.02em; }
  .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
  .card-title { font-weight: 800; font-size: 18px; color: var(--text); }

  /* Clean Tables */
  .table-clean { width: 100%; border-collapse: separate; border-spacing: 0; }
  .table-clean th { 
    text-align: left; padding: 12px 16px; 
    color: var(--muted); font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;
    border-bottom: 1px solid rgba(90, 64, 50, 0.1);
  }
  .table-clean td { padding: 16px; border-bottom: 1px solid rgba(90, 64, 50, 0.06); vertical-align: top; }
  .table-clean tr:last-child td { border-bottom: none; }

  /* Interactive List Items */
  .list-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 12px 0; border-bottom: 1px solid rgba(90, 64, 50, 0.06);
  }
  .list-item:last-child { border-bottom: none; }

  /* Status Badges - Themed */
  .badge {
    display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; 
    font-size: 12px; font-weight: 700; letter-spacing: 0.02em;
  }
  /* Warm Earthy Orange for Pending */
  .badge.pending { background: rgba(160, 82, 45, 0.1); color: #A0522D; }
  /* Deep Earthy Green for Success */
  .badge.success { background: rgba(60, 90, 60, 0.1); color: #3C5A3C; }

  /* Inner Card Scrolls - Custom Scrollbar to match theme */
  .scroll-area {
    background: var(--bg); /* Use the main page beige for contrast inside the card */
    padding: 16px;
    border-radius: 12px;
    max-height: 220px;
    overflow-y: auto;
    border: 1px solid rgba(90, 64, 50, 0.05);
  }
  
  /* Webkit Scrollbar Styling */
  .scroll-area::-webkit-scrollbar { width: 6px; }
  .scroll-area::-webkit-scrollbar-track { background: transparent; }
  .scroll-area::-webkit-scrollbar-thumb { background-color: rgba(90, 64, 50, 0.15); border-radius: 10px; }
  .scroll-area::-webkit-scrollbar-thumb:hover { background-color: rgba(90, 64, 50, 0.3); }

</style>
{% endblock %}

{% block content %}

<div class="dashboard-grid" style="margin-bottom: 30px;">
  
  <div class="page-card" style="display:flex; flex-direction:column; justify-content:center;">
    <div class="stat-label">Total pending</div>
    <div class="stat-number">{{ total_pending }}</div>
    <div class="muted" style="font-size:13px;">Across all locations</div>
  </div>

  <div class="page-card">
    <div class="card-header">
      <div class="stat-label">Pending by location</div>
    </div>
    <table style="width:100%; font-size:14px;">
      {% if pending_by_location %}
        {% for r in pending_by_location %}
          <tr>
            <td style="padding: 8px 0; color:var(--text); border-bottom:1px solid rgba(90,64,50,0.05);">{{ r.location }}</td>
            <td style="padding: 8px 0; font-weight:700; text-align:right; border-bottom:1px solid rgba(90,64,50,0.05);">{{ r.count }}</td>
          </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="2" class="muted" style="padding:10px 0;">No pending items</td></tr>
      {% endif %}
    </table>
  </div>

  <div class="page-card">
    <div class="card-header">
      <div class="stat-label">Latest Activity</div>
    </div>
    <div style="display:flex; flex-direction:column;">
      {% for r in latest_records %}
        <div class="list-item">
          <div>
            <div style="font-weight:600; font-size:14px;">{{ r.location }}</div>
            <div class="muted" style="font-size:12px;">{{ r.date }}</div>
          </div>
          <a class="btn" href="{% url 'record_detail' r.pk %}" style="font-size:12px; padding: 6px 12px;">View</a>
        </div>
      {% empty %}
        <div class="muted">No records yet</div>
      {% endfor %}
    </div>
  </div>

</div>

<section class="page-card" style="margin-bottom: 30px;">
  <div class="card-header">
    <div>
      <h3 class="card-title">Top 5 Orders</h3>
      <div class="muted" style="font-size:13px; margin-top:4px;">Latest pending requisitions</div>
    </div>
    <a href="{% url 'show_all_records' %}" class="btn ghost" style="font-size:13px;">View All</a>
  </div>

  <div style="overflow-x: auto;"> <table class="table-clean">
      <thead>
        <tr>
          <th>Location &amp; Item</th>
          <th>Vendor</th>
          <th>Date</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for rec in top5_orders %}
        <tr>
          <td>
            <strong style="display:block; color:var(--text);">{{ rec.location }}</strong>
            <div class="muted" style="font-size:13px; margin-top:4px;">{{ rec.item.item_name }} <span style="opacity:0.6">× {{ rec.quantity }}</span></div>
          </td>
          <td style="font-size:14px;">{{ rec.vendor.name }}</td>
          <td style="font-size:14px; color:var(--muted);">{{ rec.date }}</td>
          <td>
            {% if rec.status|lower == "pending" %}
              <span class="badge pending">Pending</span>
            {% else %}
              <span class="badge success">Completed</span>
            {% endif %}
          </td>
          <td style="text-align:right;">
            <a class="btn" href="{% url 'record_detail' rec.pk %}" style="padding:6px 12px;">Details</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<section class="dashboard-grid">
  {% for card in location_cards %}
    <article class="page-card" style="display:flex; flex-direction:column; gap:20px;">
      
      <div style="display:flex; justify-content:space-between; align-items:flex-start;">
        <div>
          <div style="font-weight:800; font-size:18px;">{{ card.location }}</div>
          <div class="muted" style="font-size:12px; margin-top:4px;">
            <span style="color:#A0522D; font-weight:600;">{{ card.pending_count }} Pending</span> &bull; {{ card.successful_count }} Done
          </div>
        </div>
        <a class="btn" href="{% url 'show_all_records' %}?location={{ card.location }}" style="padding:6px 10px;">Filter</a>
      </div>

      <div>
        <div class="stat-label" style="margin-bottom:8px; font-size:11px;">Pending Items</div>
        <div class="scroll-area">
          {% if card.pending %}
            {% for r in card.pending %}
              <div style="display:flex; justify-content:space-between; margin-bottom:12px; padding-bottom:12px; border-bottom:1px solid rgba(0,0,0,0.03);">
                <div>
                  <div style="font-weight:600; font-size:13px; color:var(--text);">{{ r.vendor.name }}</div>
                  <div class="muted" style="font-size:12px;">{{ r.item.item_name }} × {{ r.quantity }}</div>
                </div>
                <div style="text-align:right; flex-shrink:0;">
                  <span class="badge pending" style="font-size:10px;">{{ r.status }}</span>
                  <div style="margin-top:4px;">
                    <a class="muted" style="font-size:11px; text-decoration:underline;" href="{% url 'record_detail' r.pk %}">View</a>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="muted" style="font-size:13px; text-align:center; padding:10px;">No pending records</div>
          {% endif %}
        </div>
      </div>

      <div>
        <div class="stat-label" style="margin-bottom:8px; font-size:11px;">Recent History</div>
        <div class="scroll-area" style="background:transparent; border:none; padding-left:0; padding-right:0;">
          {% if card.successful %}
            {% for r in card.successful %}
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <div style="font-size:13px; color:var(--muted);">
                  {{ r.vendor.name }} &rarr; {{ r.item.item_name }}
                </div>
                <a class="muted" style="font-size:11px;" href="{% url 'record_detail' r.pk %}">View</a>
              </div>
            {% endfor %}
          {% else %}
            <div class="muted" style="font-size:13px;">No history available</div>
          {% endif %}
        </div>
      </div>

    </article>
  {% endfor %}
</section>

{% endblock %}